{
"version":3,
"file":"goog.dom.browserrange.w3crange.js",
"lineCount":238,
"mappings":"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",
"sources":["goog/dom/browserrange/w3crange.js"],
"sourcesContent":["// Copyright 2007 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Definition of the W3C spec following range wrapper.\n *\n * DO NOT USE THIS FILE DIRECTLY.  Use goog.dom.Range instead.\n *\n * @author robbyw@google.com (Robby Walker)\n */\n\n\ngoog.provide('goog.dom.browserrange.W3cRange');\n\ngoog.require('goog.array');\ngoog.require('goog.dom');\ngoog.require('goog.dom.NodeType');\ngoog.require('goog.dom.RangeEndpoint');\ngoog.require('goog.dom.TagName');\ngoog.require('goog.dom.browserrange.AbstractRange');\ngoog.require('goog.string');\ngoog.require('goog.userAgent');\n\n\n\n/**\n * The constructor for W3C specific browser ranges.\n * @param {Range} range The range object.\n * @constructor\n * @extends {goog.dom.browserrange.AbstractRange}\n */\ngoog.dom.browserrange.W3cRange = function(range) {\n  this.range_ = range;\n};\ngoog.inherits(\n    goog.dom.browserrange.W3cRange, goog.dom.browserrange.AbstractRange);\n\n\n/**\n * Returns a browser range spanning the given node's contents.\n * @param {Node} node The node to select.\n * @return {!Range} A browser range spanning the node's contents.\n * @protected\n */\ngoog.dom.browserrange.W3cRange.getBrowserRangeForNode = function(node) {\n  var nodeRange = goog.dom.getOwnerDocument(node).createRange();\n\n  if (node.nodeType == goog.dom.NodeType.TEXT) {\n    nodeRange.setStart(node, 0);\n    nodeRange.setEnd(node, node.length);\n  } else {\n    /** @suppress {missingRequire} */\n    if (!goog.dom.browserrange.canContainRangeEndpoint(node)) {\n      var rangeParent = node.parentNode;\n      var rangeStartOffset = goog.array.indexOf(rangeParent.childNodes, node);\n      nodeRange.setStart(rangeParent, rangeStartOffset);\n      nodeRange.setEnd(rangeParent, rangeStartOffset + 1);\n    } else {\n      var tempNode, leaf = node;\n      while ((tempNode = leaf.firstChild) &&\n             /** @suppress {missingRequire} */\n             goog.dom.browserrange.canContainRangeEndpoint(tempNode)) {\n        leaf = tempNode;\n      }\n      nodeRange.setStart(leaf, 0);\n\n      leaf = node;\n      /** @suppress {missingRequire} Circular dep with browserrange */\n      while ((tempNode = leaf.lastChild) &&\n             goog.dom.browserrange.canContainRangeEndpoint(tempNode)) {\n        leaf = tempNode;\n      }\n      nodeRange.setEnd(\n          leaf, leaf.nodeType == goog.dom.NodeType.ELEMENT ?\n              leaf.childNodes.length :\n              leaf.length);\n    }\n  }\n\n  return nodeRange;\n};\n\n\n/**\n * Returns a browser range spanning the given nodes.\n * @param {Node} startNode The node to start with - should not be a BR.\n * @param {number} startOffset The offset within the start node.\n * @param {Node} endNode The node to end with - should not be a BR.\n * @param {number} endOffset The offset within the end node.\n * @return {!Range} A browser range spanning the node's contents.\n * @protected\n */\ngoog.dom.browserrange.W3cRange.getBrowserRangeForNodes = function(\n    startNode, startOffset, endNode, endOffset) {\n  // Create and return the range.\n  var nodeRange = goog.dom.getOwnerDocument(startNode).createRange();\n  nodeRange.setStart(startNode, startOffset);\n  nodeRange.setEnd(endNode, endOffset);\n  return nodeRange;\n};\n\n\n/**\n * Creates a range object that selects the given node's text.\n * @param {Node} node The node to select.\n * @return {!goog.dom.browserrange.W3cRange} A Gecko range wrapper object.\n */\ngoog.dom.browserrange.W3cRange.createFromNodeContents = function(node) {\n  return new goog.dom.browserrange.W3cRange(\n      goog.dom.browserrange.W3cRange.getBrowserRangeForNode(node));\n};\n\n\n/**\n * Creates a range object that selects between the given nodes.\n * @param {Node} startNode The node to start with.\n * @param {number} startOffset The offset within the start node.\n * @param {Node} endNode The node to end with.\n * @param {number} endOffset The offset within the end node.\n * @return {!goog.dom.browserrange.W3cRange} A wrapper object.\n */\ngoog.dom.browserrange.W3cRange.createFromNodes = function(\n    startNode, startOffset, endNode, endOffset) {\n  return new goog.dom.browserrange.W3cRange(\n      goog.dom.browserrange.W3cRange.getBrowserRangeForNodes(\n          startNode, startOffset, endNode, endOffset));\n};\n\n\n/**\n * @return {!goog.dom.browserrange.W3cRange} A clone of this range.\n * @override\n */\ngoog.dom.browserrange.W3cRange.prototype.clone = function() {\n  return new this.constructor(this.range_.cloneRange());\n};\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.getBrowserRange = function() {\n  return this.range_;\n};\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.getContainer = function() {\n  return this.range_.commonAncestorContainer;\n};\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.getStartNode = function() {\n  return this.range_.startContainer;\n};\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.getStartOffset = function() {\n  return this.range_.startOffset;\n};\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.getEndNode = function() {\n  return this.range_.endContainer;\n};\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.getEndOffset = function() {\n  return this.range_.endOffset;\n};\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.compareBrowserRangeEndpoints =\n    function(range, thisEndpoint, otherEndpoint) {\n  return this.range_.compareBoundaryPoints(\n      otherEndpoint == goog.dom.RangeEndpoint.START ?\n          (thisEndpoint == goog.dom.RangeEndpoint.START ?\n               goog.global['Range'].START_TO_START :\n               goog.global['Range'].START_TO_END) :\n          (thisEndpoint == goog.dom.RangeEndpoint.START ?\n               goog.global['Range'].END_TO_START :\n               goog.global['Range'].END_TO_END),\n      /** @type {Range} */ (range));\n};\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.isCollapsed = function() {\n  return this.range_.collapsed;\n};\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.getText = function() {\n  return this.range_.toString();\n};\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.getValidHtml = function() {\n  var div = goog.dom.getDomHelper(this.range_.startContainer)\n                .createDom(goog.dom.TagName.DIV);\n  div.appendChild(this.range_.cloneContents());\n  var result = div.innerHTML;\n\n  if (goog.string.startsWith(result, '<') ||\n      !this.isCollapsed() && !goog.string.contains(result, '<')) {\n    // We attempt to mimic IE, which returns no containing element when a\n    // only text nodes are selected, does return the containing element when\n    // the selection is empty, and does return the element when multiple nodes\n    // are selected.\n    return result;\n  }\n\n  var container = this.getContainer();\n  container = container.nodeType == goog.dom.NodeType.ELEMENT ?\n      container :\n      container.parentNode;\n\n  var html = goog.dom.getOuterHtml(\n      /** @type {!Element} */ (container.cloneNode(false)));\n  return html.replace('>', '>' + result);\n};\n\n\n// SELECTION MODIFICATION\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.select = function(reverse) {\n  var win = goog.dom.getWindow(goog.dom.getOwnerDocument(this.getStartNode()));\n  this.selectInternal(win.getSelection(), reverse);\n};\n\n\n/**\n * Select this range.\n * @param {Selection} selection Browser selection object.\n * @param {*} reverse Whether to select this range in reverse.\n * @protected\n */\ngoog.dom.browserrange.W3cRange.prototype.selectInternal = function(\n    selection, reverse) {\n  // Browser-specific tricks are needed to create reversed selections\n  // programatically. For this generic W3C codepath, ignore the reverse\n  // parameter.\n  selection.removeAllRanges();\n  selection.addRange(this.range_);\n};\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.removeContents = function() {\n  var range = this.range_;\n  range.extractContents();\n\n  if (range.startContainer.hasChildNodes()) {\n    // Remove any now empty nodes surrounding the extracted contents.\n    var rangeStartContainer =\n        range.startContainer.childNodes[range.startOffset];\n    if (rangeStartContainer) {\n      var rangePrevious = rangeStartContainer.previousSibling;\n\n      if (goog.dom.getRawTextContent(rangeStartContainer) == '') {\n        goog.dom.removeNode(rangeStartContainer);\n      }\n\n      if (rangePrevious && goog.dom.getRawTextContent(rangePrevious) == '') {\n        goog.dom.removeNode(rangePrevious);\n      }\n    }\n  }\n\n  if (goog.userAgent.EDGE_OR_IE) {\n    // Unfortunately, when deleting a portion of a single text node, IE creates\n    // an extra text node instead of modifying the nodeValue of the start node.\n    // We normalize for that behavior here, similar to code in\n    // goog.dom.browserrange.IeRange#removeContents\n    // See https://connect.microsoft.com/IE/feedback/details/746591\n    var startNode = this.getStartNode();\n    var startOffset = this.getStartOffset();\n    var endNode = this.getEndNode();\n    var endOffset = this.getEndOffset();\n    var sibling = startNode.nextSibling;\n    if (startNode == endNode && startNode.parentNode &&\n        startNode.nodeType == goog.dom.NodeType.TEXT && sibling &&\n        sibling.nodeType == goog.dom.NodeType.TEXT) {\n      startNode.nodeValue += sibling.nodeValue;\n      goog.dom.removeNode(sibling);\n\n      // Modifying the node value clears the range offsets. Reselect the\n      // position in the modified start node.\n      range.setStart(startNode, startOffset);\n      range.setEnd(endNode, endOffset);\n    }\n  }\n};\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.surroundContents = function(element) {\n  this.range_.surroundContents(element);\n  return element;\n};\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.insertNode = function(node, before) {\n  var range = this.range_.cloneRange();\n  range.collapse(before);\n  range.insertNode(node);\n  range.detach();\n\n  return node;\n};\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.surroundWithNodes = function(\n    startNode, endNode) {\n  var win = goog.dom.getWindow(goog.dom.getOwnerDocument(this.getStartNode()));\n  /** @suppress {missingRequire} */\n  var selectionRange = goog.dom.Range.createFromWindow(win);\n  if (selectionRange) {\n    var sNode = selectionRange.getStartNode();\n    var eNode = selectionRange.getEndNode();\n    var sOffset = selectionRange.getStartOffset();\n    var eOffset = selectionRange.getEndOffset();\n  }\n\n  var clone1 = this.range_.cloneRange();\n  var clone2 = this.range_.cloneRange();\n\n  clone1.collapse(false);\n  clone2.collapse(true);\n\n  clone1.insertNode(endNode);\n  clone2.insertNode(startNode);\n\n  clone1.detach();\n  clone2.detach();\n\n  if (selectionRange) {\n    // There are 4 ways that surroundWithNodes can wreck the saved\n    // selection object. All of them happen when an inserted node splits\n    // a text node, and one of the end points of the selection was in the\n    // latter half of that text node.\n    //\n    // Clients of this library should use saveUsingCarets to avoid this\n    // problem. Unfortunately, saveUsingCarets uses this method, so that's\n    // not really an option for us. :( We just recompute the offsets.\n    var isInsertedNode = function(n) { return n == startNode || n == endNode; };\n    if (sNode.nodeType == goog.dom.NodeType.TEXT) {\n      while (sOffset > sNode.length) {\n        sOffset -= sNode.length;\n        do {\n          sNode = sNode.nextSibling;\n        } while (isInsertedNode(sNode));\n      }\n    }\n\n    if (eNode.nodeType == goog.dom.NodeType.TEXT) {\n      while (eOffset > eNode.length) {\n        eOffset -= eNode.length;\n        do {\n          eNode = eNode.nextSibling;\n        } while (isInsertedNode(eNode));\n      }\n    }\n\n    /** @suppress {missingRequire} */\n    goog.dom.Range\n        .createFromNodes(\n            sNode, /** @type {number} */ (sOffset), eNode,\n            /** @type {number} */ (eOffset))\n        .select();\n  }\n};\n\n\n/** @override */\ngoog.dom.browserrange.W3cRange.prototype.collapse = function(toStart) {\n  this.range_.collapse(toStart);\n};\n"],
"names":["goog","provide","require","dom","browserrange","W3cRange","goog.dom.browserrange.W3cRange","range","range_","inherits","AbstractRange","getBrowserRangeForNode","goog.dom.browserrange.W3cRange.getBrowserRangeForNode","node","nodeRange","getOwnerDocument","createRange","nodeType","NodeType","TEXT","setStart","setEnd","length","canContainRangeEndpoint","rangeParent","parentNode","rangeStartOffset","array","indexOf","childNodes","tempNode","leaf","firstChild","lastChild","ELEMENT","getBrowserRangeForNodes","goog.dom.browserrange.W3cRange.getBrowserRangeForNodes","startNode","startOffset","endNode","endOffset","createFromNodeContents","goog.dom.browserrange.W3cRange.createFromNodeContents","createFromNodes","goog.dom.browserrange.W3cRange.createFromNodes","prototype","clone","goog.dom.browserrange.W3cRange.prototype.clone","constructor","cloneRange","getBrowserRange","goog.dom.browserrange.W3cRange.prototype.getBrowserRange","getContainer","goog.dom.browserrange.W3cRange.prototype.getContainer","commonAncestorContainer","getStartNode","goog.dom.browserrange.W3cRange.prototype.getStartNode","startContainer","getStartOffset","goog.dom.browserrange.W3cRange.prototype.getStartOffset","getEndNode","goog.dom.browserrange.W3cRange.prototype.getEndNode","endContainer","getEndOffset","goog.dom.browserrange.W3cRange.prototype.getEndOffset","compareBrowserRangeEndpoints","goog.dom.browserrange.W3cRange.prototype.compareBrowserRangeEndpoints","thisEndpoint","otherEndpoint","compareBoundaryPoints","RangeEndpoint","START","global","START_TO_START","START_TO_END","END_TO_START","END_TO_END","isCollapsed","goog.dom.browserrange.W3cRange.prototype.isCollapsed","collapsed","getText","goog.dom.browserrange.W3cRange.prototype.getText","toString","getValidHtml","goog.dom.browserrange.W3cRange.prototype.getValidHtml","div","getDomHelper","createDom","TagName","DIV","appendChild","cloneContents","result","innerHTML","string","startsWith","contains","container","html","getOuterHtml","cloneNode","replace","select","goog.dom.browserrange.W3cRange.prototype.select","reverse","win","getWindow","selectInternal","getSelection","goog.dom.browserrange.W3cRange.prototype.selectInternal","selection","removeAllRanges","addRange","removeContents","goog.dom.browserrange.W3cRange.prototype.removeContents","extractContents","hasChildNodes","rangeStartContainer","rangePrevious","previousSibling","getRawTextContent","removeNode","userAgent","EDGE_OR_IE","sibling","nextSibling","nodeValue","surroundContents","goog.dom.browserrange.W3cRange.prototype.surroundContents","element","insertNode","goog.dom.browserrange.W3cRange.prototype.insertNode","before","collapse","detach","surroundWithNodes","goog.dom.browserrange.W3cRange.prototype.surroundWithNodes","selectionRange","Range","createFromWindow","sNode","eNode","sOffset","eOffset","clone1","clone2","isInsertedNode","n","goog.dom.browserrange.W3cRange.prototype.collapse","toStart"]
}
