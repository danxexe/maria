{"version":3,"sources":["lark/editor.cljs"],"mappings":"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","names":["lark.editor/view-index","cljs.core/volatile!","lark.editor/view","this","G__66361","fexpr__66360","cljs.core/deref","lark.editor/mount","view","id","cljs.core.get_in.cljs$core$IFn$_invoke$arity$2","js/Error","fexpr__66362","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","lark.editor/unmount","cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2","lark.editor/of-block","block","chia.view/flush!","G__66366","x__4433__auto__","m__4434__auto__","lark.editor/kind","goog/typeOf","m__4431__auto__","cljs.core/missing-protocol","lark.editor/IKind","lark.editor/get-selections","lark.editor/put-selections!","lark.editor/IHistory","selections","lark.editor/get-cursor","lark.editor/set-cursor","lark.editor/cursor-coords","lark.editor/coords-cursor","lark.editor/start","lark.editor/end","lark.editor/-focus!","lark.editor/ICursor","position","client-x","client-y","coords","var_args","G__66524","lark.editor/focus!","editor","lark.editor.focus_BANG_.cljs$core$IFn$_invoke$arity$2","lark.editor/at-start?","G__66532","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","lark.editor/at-end?","lark.editor/scroll-into-view","temp__5720__auto__","scroll-y","js/window"],"sourcesContent":["(ns lark.editor\n  (:require [chia.view :as v]))\n\n(def view-index (volatile! {}))\n\n(defn view [this]\n  (@view-index (:id this)))\n\n(defn mount [view]\n  (let [id (get-in view [:block :id])]\n    (assert (nil? (@view-index id)))                        ;; multiple simultaneous editors of a block are not yet supported\n    (vswap! view-index assoc id view)))\n\n(defn unmount [view]\n  (vswap! view-index dissoc (:id (:block view))))\n\n(defn of-block [block]\n  (when-not (view block)\n    (v/flush!))\n  (some-> (view block)\n          (.getEditor)))\n\n(defprotocol IKind\n  (kind [this]))\n\n(defprotocol IHistory\n  (get-selections [this])\n  (put-selections! [this selections]))\n\n(defprotocol ICursor\n  (get-cursor [this])\n  (set-cursor [this position])\n  (cursor-coords [this])\n  (coords-cursor [this client-x client-y])\n\n  (start [this])\n  (end [this])\n\n  (-focus! [this coords]))\n\n(defn focus!\n  ([editor]\n   (focus! editor nil))\n  ([editor coords]\n   (-focus! editor coords)\n   true))\n\n(defn at-start? [editor]\n  (some-> (get-cursor editor)\n          (= (start editor))))\n\n(defn at-end? [editor]\n  (= (get-cursor editor)\n     (end editor)))\n\n(defn scroll-into-view [coords]\n  (when-let [scroll-y (cond (neg? (.-top coords))\n                            (-> (.-scrollY js/window)\n                                (+ (.-top coords))\n                                (- 100))\n                            (> (.-top coords) (.-innerHeight js/window))\n                            (-> (.-scrollY js/window)\n                                (+ (- (.-top coords)\n                                      (.-innerHeight js/window)))\n                                (+ 100))\n                            :else nil)]\n    (.scrollTo js/window 0 scroll-y)))"]}