{"version":3,"sources":["maria/views/floating/float_ui.cljs"],"mappings":"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","names":["p__98777","map__98780","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","maria.views.floating.float-ui/tear-down!","state","temp__5720__auto__","teardown","cljs.core/deref","p__98798","map__98801","cljs.core.get.cljs$core$IFn$_invoke$arity$3","maria.views.floating.float-ui/setup-listener!","cancel-events","this","the-events","cljs.core/to-array","this-node","chia.view/dom-node","callback","e","cljs.core/not","chia.routing/closest","cljs.core.partial.cljs$core$IFn$_invoke$arity$2","cljs.core/=","cljs.core.not_EQ_.cljs$core$IFn$_invoke$arity$2","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","js/document","G__98815","chia.db/transact!","goog.events/listen","js/window","*silent*-orig-val__98818","chia.reactive/*silent*","*silent*-temp-val__98819","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$4","cljs.core/assoc","goog.events/unlisten","*silent*-orig-val__98826","*silent*-temp-val__98827","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$3","cljs.core/dissoc","chia.view.class/view*","p__98877","map__98878","vec__98879","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","chia.view.props/to-element","props98847","G__98845","chia.view.class/Component","obj98895","obj98897","maria.views.floating.float-ui/FloatingContainer","p__98849","map__98858","map__98859","prev-cancel-events","component","props","element","offset","left","top","maria.views.error/error-boundary","_","cljs.core/first","cljs.core/second","BOTTOM_PADDING","or__4131__auto__","max-height","G__98893","cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic","maria.views.floating.float-ui/show-floating-view","G__98912","G__98916","G__98917","chia.db/get","maria.views.floating.float-ui/floating-view!","data","G__98933","maria.views.floating.float-ui/current-view","G__98939","G__98940","maria.views.floating.float-ui/clear!","G__98949","lark.commands.registry/register!","G__98953","G__98954","G__98956","G__98959","chia.db/contains?","context"],"sourcesContent":["(ns maria.views.floating.float-ui\n  (:require [chia.view :as v]\n            [lark.commands.registry :refer-macros [defcommand]]\n            [chia.db :as d]\n            [chia.routing :as routing]\n            [goog.events :as events]\n            [maria.views.error :as error]\n            [chia.reactive :as r])\n  (:import [goog.events EventType]))\n\n(defn tear-down! [{:keys [view/state]}]\n                              (when-let [teardown (:teardown @state)]\n                                (teardown)))\n\n(defn setup-listener! [{:keys [view/state cancel-events] :as this\n                                  :or   {cancel-events [\"mousedown\" \"focus\" \"scroll\"]}}]\n  (tear-down! this)\n                              (let [the-events (to-array cancel-events)\n        this-node (v/dom-node this)\n                                    callback (fn [e]\n                   (when (and (not (routing/closest (.-target e) (partial = this-node)))\n                                                          (or (not= (.-type e) \"scroll\")\n                                                              (= (.-target e) js/document)))\n                     (tear-down! this)\n                                                 (d/transact! [[:db/retract-attr :ui/globals :floating-hint]])))]\n                                (events/listen js/window the-events callback true)\n    (r/silently (swap! state assoc :teardown #(do (events/unlisten js/window the-events callback true)\n                                                  (r/silently (swap! state dissoc :teardown)))))))\n\n(v/defclass FloatingContainer\n  {:view/did-mount (fn [this] (setup-listener! this))\n   :view/did-update (fn [{cancel-events :cancel-events\n                                  {prev-cancel-events :cancel-events} :view/prev-props :as this}]\n                              (when-not (= cancel-events prev-cancel-events)\n                        (setup-listener! this)))\n   :view/will-unmount (fn [this] (tear-down! this))}\n  [{:keys [component props element float/offset]\n    [left top] :float/pos\n    :or   {offset [0 0]}}]\n  [error/error-boundary\n    {:on-error (fn [_ _])}\n    (let [left (+ left (first offset))\n          top (+ top (second offset))\n          BOTTOM_PADDING (or (-> (.getElementById js/document \"bottom-bar\")\n                                 (.-width)) 0)\n          max-height (-> (.-innerHeight js/window)\n                         (- (- top (.-scrollY js/window)))\n                         (- BOTTOM_PADDING))]\n      [:.absolute.z-9999\n       {:style {:top  top\n                :left left}}\n       (or element\n           (component (merge props\n                             #:ui {:top        top\n                                   :left       left\n                                  :max-height max-height})))])])\n\n(defn show-floating-view []\n  (some-> (d/get :ui/globals :floating-hint)\n          (FloatingContainer)))\n\n(defn floating-view! [data]\n  (d/transact! [[:db/add :ui/globals :floating-hint data]]))\n\n(defn current-view [] (d/get :ui/globals :floating-hint))\n\n(defn clear! []\n  (d/transact! [[:db/retract-attr :ui/globals :floating-hint]]))\n\n(defcommand :floating-ui/exit\n  {:bindings [\"Esc\"]\n   :private  true\n   :when     #(d/contains? :ui/globals :floating-hint)}\n  [context]\n  (clear!))"]}