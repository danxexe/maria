{"version":3,"sources":["maria/persistence/local.cljs"],"mappings":";;;;;;;AAOA,AAAA,AAAMA,AAAUC;AAAhB,AAAoB,AAAA,AAAoBA;;AAExC,AAAA,AAAMC,AAAWD;AAAjB,AACE,AAAAE,AAAQ,AAAAC,AAAA,AAAAC,AAAUO;AAAVN,AAAA;AAAA,AAAA,AAAA,AAAAC,AAAAF;AAAA,AAAA,AAAA,AAAA,AAAAE,AAAA,AAAA,AAAAC,AAAAF,AAAAC;;AAAA,AAAAF,AAAAC;;AAAAG;;;AAAAC,AAAmC,AAACV,AAASC;AAA7C,AAAA,AAAA,AAAAU,AAAAP;AAAA,AAAA,AAAA,AAAA,AAAAO,AAAA,AAAA,AAAAH,AAAAE,AAAAC;;AAAA,AAAAP,AAAAM;;AAAAD;;;AAAR,AAAA,AAAA,AAAAN,AAAA;AAAA;;AACQ,AAAAA,AAACU;;;AAEX,AAAA,AAAMC,AAAYb,AAAGc;AAArB,AACE,AAAAC,AAAU,AAAgBJ;AADF,AACxB,AAAA,AAAAK,AAAA,AAAA,AAAA,AAAAD,AAAA,AAAAA;AAAA,AAAA,AAAAC,AAAqC,AAACjB,AAASC,AAAI,AAACiB,AAAYH;;AAAhEE;;AAEF,AAAA,AAAA,AAAAE,AAAMM;AAAN,AAAA,AAAAL,AAAA;AAAA,AAAA,AAAAC,AAAA,AAAA;AAAA,AAAA,AAAAC,AAAA;;AAAA,AAAA,AAAA,AAAAA,AAAAD;AAAA,AAAA,AAAAD,AAAA,AAAA,AAAAE;;AAAA,AAAA,AAAAA,AAAA;;;;AAAA;;;;AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAH,AAAA,AAAA,AAAAI,AAAA,AAAAJ,AAAA,AAAA,AAAA,AAAA;AAAA,AAAA,AAAAK,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAF;;;AAAA,AAAA,AAAA,AAAA,AAAME,AAAexB,AAAG+B,AAAIC;AAA5B,AACE,AAACnB,AAAWb,AAAG,AAACiC,AAAMF,AAAE,AAAC9B,AAAUD,AAAIgC;;;AADzC,AAAA,AAAA,AAAMR;;AAAN;AAAA,AAAA,AAAA,AAAAC,AAAMD;AAAN,AAAA,AAAAE,AAAA,AAAAC,AAAAF;AAAAA,AAAA,AAAAG,AAAAH;AAAAI,AAAA,AAAAF,AAAAF;AAAAA,AAAA,AAAAG,AAAAH;AAAA,AAAA,AAAAK,AAAA;AAAA,AAAA,AAAAA,AAAAJ,AAAAG,AAAAJ;;;AAAA,AAGA;;;AAAKS,AAEH,AAACC,AAAQ;;AACInC;AADJ,AAEG,AAAAoC,AAAA,AAAA,AAAA,AAAA,AAAsB,AAACnC,AAAUD,AACXA;AADtB,AAAA,AAAAoC,AAAAA,AAACC,AAAAA,AAAAA;;AAED,AAAAC,AAAU,AAAAG,AAAA;AAAA,AAAc,AAAC5B,AAAWb,AAAG,AAAA4C,AAAO5C;AAAP6C,AAAA;AAAA,AAAA,AAAAD,AAAAC,AAAAD,AAAAC,AAACC,AAAAA,AAAAA;;;AAA9BJ,AAAA;AAAA,AAAA,AAAAD,AAAAC,AAACC;;AAAXJ,AAAA,AAAA,AAAA,AAAA,AAAA,AACkBvC;AADlB,AAAA,AAAAsC,AAAAC,AAAAD,AAAAC,AAACC,AAAAA,AAAAA;;AAEAxC,AAAG+C;AANP,AAOG,AAAM,AAAAC,AAAK,AAAA,AAAM,AAAC/C,AAAUD;AAAtB,AAAA,AAAAgD;AAA2BD;;AAA3BC;;;AAAN,AACE,AAACnC,AAAWb,AAAG+C;;AADjB;;AAEA,AAACb,AAAAA,AAAAA,AAAalC,AAAAA;;AAHbA,AAAG+C;;;AAAH/C;;AAAAA,AAAG+C","names":["maria.persistence.local/local-id","id","maria.persistence.local/local-get","G__67341","obj67344","obj67342","k67343","obj67346","applied-science.js-interop.impl/in?*","js/undefined","k67345","obj67348","js/window","maria.persistence.transit/deserialize","maria.persistence.local/local-put!","data","obj67352","obj67353","maria.persistence.transit/serialize","var_args","args__4736__auto__","len__4730__auto__","i__4731__auto__","argseq__4737__auto__","cljs.core/IndexedSeq","maria.persistence.local/local-update!","seq67361","G__67362","cljs.core/first","cljs.core/next","G__67363","self__4717__auto__","f","args","cljs.core.apply.cljs$core$IFn$_invoke$arity$3","maria.persistence.local/init-storage","cljs.core/memoize","G__67371","chia.db/transact!","G__67372","G__67373","chia.db/listen","G__67374","G__67375","goog.functions/throttle","G__67376","G__67377","chia.db/get","initial-content","and__4120__auto__"],"sourcesContent":["(ns maria.persistence.local\n  (:require [chia.db :as d]\n            [chia.reactive :as r]\n            [maria.persistence.transit :as t]\n            [goog.functions :as gf]\n            [applied-science.js-interop :as j]))\n\n(defn local-id [id] (str \"maria.local/\" id))\n\n(defn local-get [id]\n  (some-> (j/get-in js/window [:localStorage (local-id id)])\n          (t/deserialize)))\n\n(defn local-put! [id data]\n  (j/assoc! (.-localStorage js/window) (local-id id) (t/serialize data)))\n\n(defn local-update! [id f & args]\n  (local-put! id (apply f (local-get id) args)))\n\n(def init-storage\n  \"Given a unique id, initialize a local-storage backed source\"\n  (memoize (fn\n             ([id]\n              (d/transact! [{:local (local-get id)\n                             :db/id id}])\n              (d/listen (gf/throttle #(local-put! id (d/get id :local)) 300)\n                        {:ea_ [[id :local]]}))\n             ([id initial-content]\n              (when (and (nil? (local-get id)) initial-content)\n                (local-put! id initial-content))\n              (init-storage id)))))\n\n"]}